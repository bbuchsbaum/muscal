<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linked Multiple Factor Analysis • muscal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Linked Multiple Factor Analysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">muscal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/linked_mfa.html">Linked Multiple Factor Analysis</a>
    </li>
    <li>
      <a href="../articles/mfa.html">Multiple Factor Analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Linked Multiple Factor Analysis</h1>
            
      

      <div class="hidden name"><code>linked_mfa.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="why-linked-mfa">Why Linked MFA?<a class="anchor" aria-label="anchor" href="#why-linked-mfa"></a>
</h2>
<p>Standard MFA requires all blocks to share the same observations. This
is often unrealistic. Consider neuroimaging: you have a reference
dataset (Y) with structural measures on N subjects, but your auxiliary
data—task fMRI, resting-state, behavioral assessments—are available for
overlapping but different subsets of those subjects. Some subjects
completed one scan, others completed two, and the overlap varies by
modality.</p>
<p>Linked MFA solves this. It learns a shared score matrix for the
reference observations while allowing each auxiliary block to have its
own row structure. You simply specify which rows of each auxiliary block
correspond to which rows of the reference.</p>
</div>
<div class="section level2">
<h2 id="the-model">The Model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h2>
<p>Linked MFA fits the following structure:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>≈</mo><mi>S</mi><msup><mi>B</mi><mi>⊤</mi></msup></mrow><annotation encoding="application/x-tex">Y \approx S B^\top</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>k</mi></msub><mo>≈</mo><mi>S</mi><mo stretchy="false" form="prefix">[</mo><msub><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">x</mi></mrow><mi>k</mi></msub><mo>,</mo><mo stretchy="false" form="postfix">]</mo><msubsup><mi>V</mi><mi>k</mi><mi>⊤</mi></msubsup></mrow><annotation encoding="application/x-tex">X_k \approx S[\mathrm{idx}_k,] V_k^\top</annotation></semantics></math></p>
<p>where:</p>
<ul>
<li>
<strong>Y</strong> is the reference block (N × q)</li>
<li>
<strong>S</strong> is the shared score matrix (N × K)</li>
<li>
<strong>B</strong> contains the loadings for Y</li>
<li>Each <strong>X_k</strong> is an auxiliary block with its own
dimensions</li>
<li>
<strong>V_k</strong> contains the loadings for block k</li>
<li>
<strong>idx_k</strong> maps rows of X_k to rows of Y</li>
</ul>
<p>The key insight: scores S live in the reference space (N rows), but
each auxiliary block contributes information through its row
mapping.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">muscal</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/multivarious/" class="external-link">multivarious</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reference block: 100 subjects, 20 variables</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="fl">20</span><span class="op">)</span>, <span class="va">N</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Auxiliary block 1: 60 subjects (subset), 30 variables</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">30</span><span class="op">)</span>, <span class="fl">60</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">idx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">60</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># which reference subjects</span></span>
<span></span>
<span><span class="co"># Auxiliary block 2: 45 subjects (different subset), 25 variables</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">45</span> <span class="op">*</span> <span class="fl">25</span><span class="op">)</span>, <span class="fl">45</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">idx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">45</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit linked MFA</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">X1</span>, X2 <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">idx1</span>, X2 <span class="op">=</span> <span class="va">idx2</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scores are defined for all N reference subjects</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/multivarious/reference/scores.html" class="external-link">scores</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>  <span class="co"># 100 x 3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="row-index-mapping">Row Index Mapping<a class="anchor" aria-label="anchor" href="#row-index-mapping"></a>
</h2>
<p>The <code>row_index</code> argument is the core of Linked MFA. Each
element maps rows of an auxiliary block to rows of the reference Y:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># row_index[[k]][i] says: "row i of X[[k]] corresponds to row row_index[[k]][i] of Y"</span></span>
<span></span>
<span><span class="co"># Example: X1 has 60 rows, mapping to specific Y rows</span></span>
<span><span class="va">idx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">60</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># length 60, values in 1..N</span></span>
<span></span>
<span><span class="co"># Subjects can appear multiple times (repeated measures)</span></span>
<span><span class="va">idx_repeated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">3L</span><span class="op">)</span>  <span class="co"># subject 1 measured 3 times</span></span></code></pre></div>
<p>This flexibility handles:</p>
<ul>
<li>
<strong>Subset data</strong>: Not all subjects have all
modalities</li>
<li>
<strong>Repeated measures</strong>: Multiple observations per
subject</li>
<li>
<strong>Unbalanced designs</strong>: Different numbers of
measurements per subject</li>
</ul>
</div>
<div class="section level2">
<h2 id="feature-similarity-prior">Feature Similarity Prior<a class="anchor" aria-label="anchor" href="#feature-similarity-prior"></a>
</h2>
<p>When auxiliary blocks measure conceptually similar features—say, the
same brain regions across different tasks—you may want corresponding
features to have similar loadings. Linked MFA supports this via a
feature grouping prior.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatic grouping by column name</span></span>
<span><span class="co"># Features with the same name across blocks are grouped together</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">X1</span>, X2 <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">idx1</span>, X2 <span class="op">=</span> <span class="va">idx2</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  feature_groups <span class="op">=</span> <span class="st">"colnames"</span>,</span>
<span>  feature_lambda <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Manual grouping via data frame</span></span>
<span><span class="va">groups_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X2"</span><span class="op">)</span>,</span>
<span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,       <span class="co"># feature indices within each block</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ROI_A"</span>, <span class="st">"ROI_B"</span>, <span class="st">"ROI_A"</span>, <span class="st">"ROI_B"</span><span class="op">)</span>,</span>
<span>  weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">X1</span>, X2 <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">idx1</span>, X2 <span class="op">=</span> <span class="va">idx2</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  feature_groups <span class="op">=</span> <span class="va">groups_df</span>,</span>
<span>  feature_lambda <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>feature_lambda</code> parameter controls the strength of
the prior. Higher values pull grouped features toward their shared
center more strongly.</p>
</div>
<div class="section level2">
<h2 id="block-normalization">Block Normalization<a class="anchor" aria-label="anchor" href="#block-normalization"></a>
</h2>
<p>Like standard MFA, Linked MFA supports block weighting:</p>
<ul>
<li>
<strong>“MFA”</strong> (default): Inverse squared first singular
value</li>
<li>
<strong>“None”</strong>: Uniform weights</li>
<li>
<strong>“custom”</strong>: User-supplied weights via
<code>alpha</code>
</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom weights: emphasize the reference block</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">X1</span>, X2 <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">idx1</span>, X2 <span class="op">=</span> <span class="va">idx2</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># Y weight, X1 weight, X2 weight</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="algorithm-details">Algorithm Details<a class="anchor" aria-label="anchor" href="#algorithm-details"></a>
</h2>
<p>Linked MFA uses alternating least squares (ALS):</p>
<ol style="list-style-type: decimal">
<li>Initialize S and B from the SVD of Y</li>
<li>Update B (Y loadings) given S</li>
<li>Update each V_k (X_k loadings) given S, with optional group
shrinkage</li>
<li>Update S row-by-row, aggregating information from Y and all X_k
blocks</li>
<li>Orthonormalize S; rotate all loadings to preserve fitted values</li>
<li>Repeat until convergence</li>
</ol>
<p>Convergence is monitored via the reconstruction objective. Use
<code>verbose = TRUE</code> to track progress.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">X1</span>, X2 <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="va">idx1</span>, X2 <span class="op">=</span> <span class="va">idx2</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect convergence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">objective_trace</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Iteration"</span>, ylab <span class="op">=</span> <span class="st">"Objective"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-results">Working with Results<a class="anchor" aria-label="anchor" href="#working-with-results"></a>
</h2>
<p>The returned object behaves like a standard
<code>multiblock_biprojector</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Global scores (N x ncomp)</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/multivarious/reference/scores.html" class="external-link">scores</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Concatenated loadings (rows correspond to Y then each X block)</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">v</span></span>
<span></span>
<span><span class="co"># Block-specific loadings</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">B</span>        <span class="co"># Y loadings (q x ncomp)</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">V_list</span>   <span class="co"># list of X_k loadings</span></span>
<span></span>
<span><span class="co"># Block indices in concatenated space</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">block_indices</span></span>
<span></span>
<span><span class="co"># Row mappings</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">row_index</span></span>
<span></span>
<span><span class="co"># Convergence trace</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">objective_trace</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>Linked MFA has specialized plotting functions that account for the
heterogeneous row structure.</p>
<div class="section level3">
<h3 id="score-plot-with-coverage">Score Plot with Coverage<a class="anchor" aria-label="anchor" href="#score-plot-with-coverage"></a>
</h3>
<p>The default plot colors observations by how many blocks contribute to
their scores:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Base R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ggplot2 (if installed)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit</span>, color <span class="op">=</span> <span class="st">"coverage"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom coloring (overrides coverage)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit</span>, color <span class="op">=</span> <span class="va">some_grouping_variable</span><span class="op">)</span></span></code></pre></div>
<p>Observations with more block coverage have more information sources
informing their position.</p>
</div>
<div class="section level3">
<h3 id="block-coverage-map">Block Coverage Map<a class="anchor" aria-label="anchor" href="#block-coverage-map"></a>
</h3>
<p>Visualize the missingness structure:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_coverage.html">plot_coverage</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>This heatmap shows which observations are present in which
blocks—essential for understanding your data’s overlap structure.</p>
</div>
<div class="section level3">
<h3 id="convergence-diagnostics">Convergence Diagnostics<a class="anchor" aria-label="anchor" href="#convergence-diagnostics"></a>
</h3>
<p>Monitor the ALS algorithm:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log scale for better visibility of late iterations</span></span>
<span><span class="fu"><a href="../reference/plot_convergence.html">plot_convergence</a></span><span class="op">(</span><span class="va">fit</span>, log_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>A healthy convergence trace decreases monotonically and flattens as
it approaches the solution.</p>
</div>
<div class="section level3">
<h3 id="partial-factor-scores">Partial Factor Scores<a class="anchor" aria-label="anchor" href="#partial-factor-scores"></a>
</h3>
<p>Compare block-specific views:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_partial_scores.html">plot_partial_scores</a></span><span class="op">(</span><span class="va">fit</span>, show_consensus <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>For Linked MFA, this shows where each auxiliary block’s observations
fall, with open circles marking the reference positions in S.</p>
</div>
<div class="section level3">
<h3 id="feature-group-alignment">Feature Group Alignment<a class="anchor" aria-label="anchor" href="#feature-group-alignment"></a>
</h3>
<p>If you used <code>feature_groups</code>, visualize how grouped
features align:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_feature_groups.html">plot_feature_groups</a></span><span class="op">(</span><span class="va">fit</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, show_centers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Features in the same group are connected to their group center. Tight
clusters indicate the feature prior successfully aligned corresponding
variables.</p>
</div>
<div class="section level3">
<h3 id="block-weights-and-fit">Block Weights and Fit<a class="anchor" aria-label="anchor" href="#block-weights-and-fit"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Block normalization weights</span></span>
<span><span class="fu"><a href="../reference/plot_block_weights.html">plot_block_weights</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Relative reconstruction quality per block</span></span>
<span><span class="fu"><a href="../reference/plot_block_fit.html">plot_block_fit</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variable-loadings">Variable Loadings<a class="anchor" aria-label="anchor" href="#variable-loadings"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation circle</span></span>
<span><span class="fu"><a href="../reference/plot_loadings.html">plot_loadings</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"circle"</span>, color_by <span class="op">=</span> <span class="st">"block"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Top loadings for component 1</span></span>
<span><span class="fu"><a href="../reference/plot_loadings.html">plot_loadings</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"bar"</span>, component <span class="op">=</span> <span class="fl">1</span>, top_n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="when-to-use-linked-mfa">When to Use Linked MFA<a class="anchor" aria-label="anchor" href="#when-to-use-linked-mfa"></a>
</h2>
<p>Linked MFA is appropriate when:</p>
<ul>
<li>You have a reference dataset with complete observations</li>
<li>Auxiliary datasets are measured on overlapping but incomplete
subsets</li>
<li>You want to learn a shared representation in the reference
space</li>
<li>Features across blocks may have conceptual correspondence</li>
</ul>
<p>Linked MFA is <em>not</em> appropriate when:</p>
<ul>
<li>All blocks share identical observations (use standard MFA)</li>
<li>There is no natural reference block</li>
<li>Block relationships are better captured by other methods (e.g., CCA
for two blocks with different row and column spaces)</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-multi-session-neuroimaging">Example: Multi-Session Neuroimaging<a class="anchor" aria-label="anchor" href="#example-multi-session-neuroimaging"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Y: structural MRI on 200 subjects (all have this)</span></span>
<span><span class="co"># X1: task fMRI session 1 (150 subjects completed)</span></span>
<span><span class="co"># X2: task fMRI session 2 (120 subjects completed)</span></span>
<span><span class="co"># X3: resting state (180 subjects completed)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linked_mfa.html">linked_mfa</a></span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="va">structural_data</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>task1 <span class="op">=</span> <span class="va">task1_data</span>, task2 <span class="op">=</span> <span class="va">task2_data</span>, rest <span class="op">=</span> <span class="va">rest_data</span><span class="op">)</span>,</span>
<span>  row_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>task1 <span class="op">=</span> <span class="va">task1_subjects</span>,</span>
<span>                   task2 <span class="op">=</span> <span class="va">task2_subjects</span>,</span>
<span>                   rest <span class="op">=</span> <span class="va">rest_subjects</span><span class="op">)</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  feature_groups <span class="op">=</span> <span class="st">"colnames"</span>,  <span class="co"># same ROIs across sessions</span></span>
<span></span>
<span>  feature_lambda <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scores are defined for all 200 subjects,</span></span>
<span><span class="co"># integrating information from whatever sessions each completed</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Linked MFA extends the classical MFA framework to handle
heterogeneous row structures. The algorithm is based on weighted
alternating least squares with an optional quadratic group-shrinkage
penalty on loadings for user-specified feature groups.</p>
<p>For background on MFA:</p>
<p>Escofier, B., &amp; Pagès, J. (1994). Multiple factor analysis
(AFMULT package). <em>Computational Statistics &amp; Data Analysis</em>,
18(1), 121-140.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
