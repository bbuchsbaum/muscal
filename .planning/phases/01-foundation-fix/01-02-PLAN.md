---
phase: 01-foundation-fix
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - R/bada.R
  - R/all_generic.R
autonomous: true

must_haves:
  truths:
    - "No S3 method signature mismatch warnings from R CMD check"
    - "S3 methods match their generic signatures"
    - "No triple-colon private API usage (multivarious:::)"
  artifacts:
    - path: "R/bada.R"
      provides: "bada methods with correct signatures"
      contains: "fresh\\(|concat_pre_processors\\(|discriminant_projector\\("
    - path: "NAMESPACE"
      provides: "Proper imports for multivarious functions"
      contains: "importFrom.*multivarious"
  key_links:
    - from: "R/bada.R"
      to: "multivarious package"
      via: "exported functions (not :::)"
      pattern: "multivarious::[^:]"
---

<objective>
Fix S3 method signature mismatches and eliminate private API usage.

Purpose: Ensure R CMD check passes without signature warnings and code uses only public APIs.
Output: Clean R/bada.R with correct S3 signatures and no triple-colon (:::) calls.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@R/bada.R
@R/all_generic.R
@NAMESPACE
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix private API usage in bada.R</name>
  <files>R/bada.R</files>
  <action>
Replace the three `multivarious:::` (private API) calls with proper public API usage.

Line 161: `multivarious:::fresh(preproc) %>% multivarious::prep()`
- Check if `fresh` is exported from multivarious. If yes, use `multivarious::fresh()`.
- If not exported, the preproc object may have a method or the fresh() function may need to be re-implemented locally.

Line 237: `proc <- multivarious:::concat_pre_processors(proclist, block_indices)`
- Already imported in NAMESPACE: `importFrom(multivarious,concat_pre_processors)`
- Replace with: `proc <- multivarious::concat_pre_processors(proclist, block_indices)` or just `concat_pre_processors(proclist, block_indices)` since it's imported.

Line 239: `multivarious:::discriminant_projector(v=v, ...)`
- Already imported in NAMESPACE: `importFrom(multivarious,discriminant_projector)`
- Replace with: `multivarious::discriminant_projector(v=v, ...)` or just `discriminant_projector(v=v, ...)` since it's imported.

For fresh(): Check NAMESPACE - it shows `importFrom(multivarious,fresh)`, so it IS exported.
Replace `multivarious:::fresh(preproc)` with `multivarious::fresh(preproc)` or just `fresh(preproc)`.
  </action>
  <verify>
Run `grep -n "multivarious:::" R/bada.R` - should return 0 matches.
Run `grep -n "multivarious::" R/bada.R` - may return matches (acceptable) OR no matches if using imported names directly.
  </verify>
  <done>
R/bada.R contains no triple-colon (:::) private API calls. All multivarious functions accessed via imports or double-colon (::) public API.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix S3 method signature mismatches</name>
  <files>R/bada.R, R/all_generic.R</files>
  <action>
Check that all S3 method signatures match their generics exactly (same argument names in same order).

Known S3 methods in bada.R that need verification:
1. `bootstrap.bada(x, data, nboot=500, alpha=.05, verbose=FALSE, ...)`
   - Generic is from multivarious::bootstrap - check its signature

2. `reprocess.bada(x, new_data, colind=NULL, block=NULL)`
   - Generic is from multivarious::reprocess - check its signature

3. `project.bada(x, new_data, block)`
   - Generic is from multivarious::project - check its signature

Run `R -e "args(multivarious::bootstrap)"` to see generic signature.
Run `R -e "args(multivarious::reprocess)"` to see generic signature.
Run `R -e "args(multivarious::project)"` to see generic signature.

Ensure method signatures match. Common issues:
- Argument names must match exactly (e.g., `new_data` vs `newdata`)
- Argument order must match
- Methods must include `...` if generic has it

Also check bada.multidesign signature matches the bada generic in all_generic.R.
  </action>
  <verify>
Run `R CMD check --no-examples --no-tests . 2>&1 | grep -i "S3 method\|signature"` - should return empty or no warnings.
  </verify>
  <done>
All S3 methods in bada.R have signatures that match their generic functions. R CMD check produces no S3 signature warnings.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `grep -c ":::" R/bada.R` returns 0
2. R CMD check produces no warnings about S3 method signatures
3. R CMD check produces no notes about private API usage
</verification>

<success_criteria>
- No triple-colon (:::) calls in R/bada.R - all use public API
- S3 method signatures exactly match their generic signatures
- R CMD check signature warnings eliminated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-fix/01-02-SUMMARY.md`
</output>
