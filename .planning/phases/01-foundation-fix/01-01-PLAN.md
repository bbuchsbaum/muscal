---
phase: 01-foundation-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/mfa.R
  - DESCRIPTION
autonomous: true

must_haves:
  truths:
    - "No deprecated chkor() warnings from R CMD check"
    - "No unused import warnings from R CMD check"
    - "DESCRIPTION imports match actual package usage"
  artifacts:
    - path: "R/mfa.R"
      provides: "MFA implementation without deprecated chk calls"
      contains: "chk_vld"
    - path: "DESCRIPTION"
      provides: "Clean import declarations"
  key_links:
    - from: "R/mfa.R"
      to: "chk package"
      via: "chkor_vld() instead of chkor()"
      pattern: "chkor_vld"
---

<objective>
Fix deprecated chk package function calls and clean up DESCRIPTION imports.

Purpose: Eliminate R CMD check warnings from deprecated API usage and unused imports.
Output: Clean R/mfa.R with modern chk syntax, DESCRIPTION with accurate imports.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@R/mfa.R
@DESCRIPTION
@NAMESPACE
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix deprecated chkor() calls in mfa.R</name>
  <files>R/mfa.R</files>
  <action>
Replace the two deprecated `chk::chkor()` calls with the modern `chk::chkor_vld()` equivalent.

Line 134: `chk::chkor(chk::chk_matrix(data[[i]]), chk::chk_s4_class(data[[i]], "Matrix"))`
Replace with: `chk::chkor_vld(chk::vld_matrix(data[[i]]), chk::vld_s4_class(data[[i]], "Matrix"))`

Line 144: `chk::chkor(chk::chk_not_null(A), chk::chk_not_null(M))`
Replace with: `chk::chkor_vld(chk::vld_not_null(A), chk::vld_not_null(M))`

Note: The `chkor_vld()` function expects `vld_*` validators (which return TRUE/FALSE) rather than `chk_*` checkers (which throw errors). This is the correct modern pattern.
  </action>
  <verify>
Run `grep -n "chkor(" R/mfa.R` - should return 0 matches for deprecated pattern.
Run `grep -n "chkor_vld" R/mfa.R` - should return 2 matches.
  </verify>
  <done>
R/mfa.R contains no deprecated chkor() calls, only chkor_vld() with vld_* validators.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit and fix DESCRIPTION imports</name>
  <files>DESCRIPTION</files>
  <action>
1. Run `R CMD check` to identify specific unused import warnings
2. Cross-reference DESCRIPTION Imports with actual usage in R/*.R files
3. Remove any imports that are not actually used
4. Ensure all actually-used packages are listed

Known potential issues from codebase scan:
- genpca is listed but may cause issues if not installed (it's used in mfa.R with requireNamespace check, so it may need to move to Suggests)
- Verify all imports are actually called in code

If genpca is only used with requireNamespace(), move it from Imports to Suggests since it's an optional dependency.
  </action>
  <verify>
Run `R CMD check --no-examples --no-tests muscal 2>&1 | grep -i "unused import\|not used"` - should return empty.
  </verify>
  <done>
DESCRIPTION has no unused imports; all imported packages are actually used in code. Optional dependencies like genpca are in Suggests with requireNamespace() guards.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `grep -c "chkor(" R/mfa.R` returns 0
2. `grep -c "chkor_vld" R/mfa.R` returns 2
3. R CMD check produces no warnings about deprecated functions or unused imports
</verification>

<success_criteria>
- R/mfa.R uses chkor_vld() with vld_* validators (not deprecated chkor() with chk_* checkers)
- DESCRIPTION imports are accurate - no unused packages, no missing packages
- These specific R CMD check warnings are eliminated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-fix/01-01-SUMMARY.md`
</output>
